<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Portal de Liquidaciones | Carflex</title>

<style>
/* ====== FONDO ====== */
body{
    background-image: url("fondo formulario.jpg");
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    font-family: Arial, sans-serif;
}

/* ====== CONTENEDOR ====== */
.contenedor{
    max-width:820px; /* MÁS ANCHO */
    margin:40px auto;
    background:rgba(255,255,255,0.96);
    border-radius:8px;
    box-shadow:0 5px 15px rgba(0,0,0,0.15);
    overflow:hidden;
}

.logo{
    text-align:center;
    padding:25px;
    border-bottom:1px solid #eee;
}

.logo h1{
    margin:0;
    font-size:30px;
    letter-spacing:3px;
}

.contenido{
    padding:40px; /* MÁS AIRE */
}

h2{
    text-align:center;
    margin-top:0;
    color:#222;
}

/* ====== TEXTO INTRO ====== */
.intro{
    text-align:center;
    color:#555;
    font-size:14px;
    margin-bottom:30px;
}

/* ====== FORMULARIO ====== */
label{
    font-weight:600;
    display:block;
    margin-top:10px;
}

input, select, textarea{
    width:100%;
    padding:11px;
    margin-top:6px;
    border:1px solid #ccc;
    border-radius:5px;
    font-size:14px;
}

textarea{
    resize:none;
}

/* ====== FOCUS PROFESIONAL ====== */
input:focus, select:focus, textarea:focus{
    outline:none;
    border-color:#ff7225;
    box-shadow:0 0 0 2px rgba(255,114,37,0.15);
}

/* ====== GRID (COLUMNAS MÁS SEPARADAS) ====== */
.fila-doble{
    display:grid;
    grid-template-columns:1fr 1fr;
    column-gap:40px; /* SEPARACIÓN HORIZONTAL */
    row-gap:20px;
}

.full{
    grid-column:1 / -1;
}

/* ====== SEPARADOR ====== */
.separador{
    margin:30px 0;
    border-top:1px solid #eee;
}

/* ====== BOTÓN ====== */
button{
    width:100%;
    background:#ff7225;
    color:white;
    border:none;
    margin-top:30px;
    padding:15px;
    font-size:16px;
    border-radius:6px;
    cursor:pointer;
}

button:hover{
    background:#e5631f;
}

button:disabled{
    background:#ccc;
    cursor:not-allowed;
}

/* ====== MENSAJE DE ÉXITO ====== */
.exito{
    display:none;
    text-align:center;
    padding:60px 20px;
}

.exito h2{
    color:#033201;
    font-size:22px;
    margin-bottom:10px;
}

.exito p{
    color:#555;
}
</style>
</head>

<body>

<div class="contenedor">

    <!-- LOGO -->
    <div class="logo">
        <h1>
            <span style="color:#033201;">C</span>
            <span style="color:#033201;">A</span>
            <span style="color:#033201;">R</span>
            <span style="color:#820889;">F</span>
            <span style="color:#0dc5aa;">L</span>
            <span style="color:#ff7225;">E</span>
            <span style="color:#ffae17;">X</span>
        </h1>
        <small>Soluciones en movimiento</small>
    </div>

    <div class="contenido">

        <form id="formulario" enctype="multipart/form-data">

            <h2>Portal de Liquidaciones</h2>
            <p class="intro">
                Complete los campos para registrar la liquidación asociada a la unidad.
                Todos los campos son obligatorios.
            </p>

            <!-- FILA 1 -->
            <div class="fila-doble">
                <div>
                    <label>Nombre del taller</label>
                    <input type="text" name="nombre_taller" placeholder="Ej: Taller Mecánico San José" required>
                </div>

                <div>
                    <label>Correo electrónico del taller</label>
                    <input type="email" name="correo_taller" required>
                </div>
            </div>

            <!-- FILA 2 -->
            <div class="fila-doble">
                <div>
                    <label>Patente (sin espacios ni guión)</label>
                    <input 
                        type="text" 
                        name="patente" 
                        required 
                        maxlength="6"
                        pattern="[A-Za-z0-9]{6}"
                        oninput="this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '')"
                        placeholder="AB123C"
                    >
                </div>

                <div>
                    <label>Ciudad</label>
                    <select name="ciudad" required>
                        <option value="">Seleccione</option>
                        <option>Santiago</option>
                        <option>Valparaíso</option>
                        <option>Viña del Mar</option>
                        <option>Rancagua</option>
                        <option>Talca</option>
                        <option>Concepción</option>
                        <option>Temuco</option>
                        <option>Puerto Montt</option>
                    </select>
                </div>
            </div>

            <!-- FILA 3 -->
            <div class="fila-doble">
                <div>
                    <label>Tipo de trabajo</label>
                    <select name="tipo_trabajo" required>
                        <option value="">Seleccione</option>
                        <option>Mantención</option>
                        <option>Reparación Mecánica</option>
                        <option>Revisión Técnica</option>
                        <option>Neumático</option>
                        <option>Siniestro y DYP</option>
                        <option>Otros</option>
                    </select>
                </div>

                <div>
                    <label>Fecha de entrega de la unidad</label>
                    <input type="date" name="fecha_entrega" required>
                </div>
            </div>

            <!-- FULL -->
            <div class="full">
                <label>N° de Liquidación</label>
                <input type="text" name="numero_liquidacion" placeholder="Número interno de liquidación" required>
            </div>

            <div class="full">
                <label>Descripción del trabajo</label>
                <textarea name="descripcion_trabajo" rows="4" required></textarea>
            </div>

            <div class="separador"></div>

            <div class="full">
                <label>Adjuntar liquidación (PDF)</label>
                <input type="file" name="archivo_pdf" accept="application/pdf" required>
                <small style="color:#777;">
                    Formato permitido: PDF. El archivo quedará registrado en el sistema.
                </small>
            </div>

            <button type="submit" id="btnEnviar">Enviar Liquidación</button>
        </form>

        <div id="mensaje" class="exito">
            <h2>✅ Liquidación registrada correctamente</h2>
            <p>
                El comprobante fue enviado al correo del taller y la información quedó almacenada en el sistema.
            </p>
            <button onclick="window.location.reload()">Enviar otra liquidación</button>
        </div>

    </div>
</div>

<script>
document.getElementById("formulario").addEventListener("submit", async function(e) {
    e.preventDefault();

    const form = document.getElementById("formulario");
    const data = new FormData(form);
    const mensaje = document.getElementById("mensaje");
    const boton = document.getElementById("btnEnviar");

    boton.disabled = true;
    boton.innerText = "Enviando...";

    const webhook = "https://uncollapsible-melodiously-chung.ngrok-free.dev/webhook-test/liquidaciones";

    try {
        const res = await fetch(webhook, { method: "POST", body: data });

        if (res.ok) {
            form.style.display = "none";
            mensaje.style.display = "block";
        } else {
            alert("❌ Error al enviar la liquidación");
            boton.disabled = false;
            boton.innerText = "Enviar Liquidación";
        }
    } catch {
        alert("❌ Error de conexión");
        boton.disabled = false;
        boton.innerText = "Enviar Liquidación";
    }
});
</script>

</body>
</html>
